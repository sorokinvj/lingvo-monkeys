# Системные паттерны Lingvo Monkeys

## Архитектура системы

Lingvo Monkeys построен на современном стеке технологий веб-разработки с использованием микросервисной архитектуры для обеспечения масштабируемости и гибкости.

### Основные компоненты системы

1. **Фронтенд (Next.js)**:

   - Рендеринг пользовательского интерфейса
   - Реализация клиентской логики
   - Адаптивный дизайн (мобильный и десктопный)

2. **Бэкенд (Next.js API Routes + Supabase)**:

   - Обработка запросов клиента
   - Управление аутентификацией и авторизацией
   - Взаимодействие с базой данных и хранилищем
   - Обработка аналитики и метрик

3. **База данных (Supabase PostgreSQL)**:

   - Хранение данных пользователей
   - Хранение метаданных о загруженных видео
   - Хранение транскрипций и связанной информации
   - Хранение аналитических данных

4. **Хранилище файлов (Supabase Storage)**:

   - Хранение видео- и аудиофайлов пользователей
   - Управление доступом к файлам

5. **Сервис транскрипции**:
   - Автоматическое преобразование аудио в текст
   - Синхронизация текста с временными метками видео

## Ключевые технические решения

### Архитектура приложения

- **Монорепозиторий**: Весь код проекта хранится в одном репозитории
- **Next.js App Router**: Использование нового роутера для улучшенной организации кода
- **Server Components**: Использование серверных компонентов React для оптимизации производительности
- **API Routes**: Реализация API через Next.js API Routes

### Управление данными

- **PostgreSQL**: Основная реляционная база данных
- **Supabase**: Как сервис для управления базой данных, аутентификацией и хранилищем
- **Row Level Security**: Использование RLS для контроля доступа к данным

### Аутентификация и авторизация

- **Email/Password**: Стандартная аутентификация по email и паролю
- **JWT токены**: Использование токенов для авторизации API-вызовов
- **Ролевая модель**: Разделение пользователей на роли с разными уровнями доступа

### Потоки данных

1. **Загрузка контента**:
   Клиент → API Routes → Supabase Storage → Сервис транскрипции → База данных

2. **Просмотр контента**:
   База данных + Supabase Storage → API Routes → Клиент

3. **Аналитика**:
   Клиент → API Routes → База данных (записи активности) → Аналитические отчеты

## Компонентные взаимосвязи

- **Компоненты страниц** зависят от UI-компонентов и хуков для получения данных
- **Хуки** инкапсулируют логику получения и обработки данных, обращаясь к API-клиенту
- **API клиент** взаимодействует с API Routes или напрямую с Supabase
- **API Routes** обрабатывают запросы и взаимодействуют с Supabase
- **Middleware** обрабатывает аутентификацию и роутинг

## Ключевые пути реализации

### Путь загрузки видео

1. Пользователь загружает видео через UI компонент
2. Файл передается через API на Supabase Storage
3. Запускается процесс транскрипции
4. После завершения транскрипции, результаты сохраняются в базе данных
5. Пользователь получает уведомление о завершении процесса

### Путь воспроизведения видео

1. Пользователь выбирает видео из своей коллекции
2. Загружаются метаданные и транскрипция из базы данных
3. Загружается видеофайл из хранилища
4. Проигрыватель отображает видео и синхронизированные субтитры
5. Пользовательские действия (паузы, перемотки) отслеживаются для аналитики

### Путь аналитики

1. Пользовательские действия отслеживаются на клиенте
2. Данные отправляются на сервер через API
3. Сервер сохраняет данные в базе
4. Аналитика агрегируется и отображается в пользовательском или административном интерфейсе
