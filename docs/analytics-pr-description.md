# Система аналитики пользовательских действий

## Что реализовано

Внедрена комплексная система для отслеживания пользовательских действий в приложении, которая позволит:

1. Понимать, как пользователи взаимодействуют с приложением
2. Определять наиболее и наименее используемые функции
3. Оптимизировать пользовательский опыт на основе реальных данных

## Основные компоненты

### База данных

Созданы 6 основных таблиц для хранения аналитических данных:

- **FileUploadEvent** - отслеживание загрузок файлов
- **FileListeningEvent** - отслеживание сеансов прослушивания
- **PageViewEvent** - отслеживание просмотра страниц с данными о продолжительности
- **PlayerInteractionEvent** - отслеживание взаимодействия с плеером (play, pause, seek и т.д.)
- **TranscriptInteractionEvent** - отслеживание взаимодействия с транскрипцией
- **SettingsChangeEvent** - отслеживание изменений пользовательских настроек

Все таблицы используют Row Level Security (RLS), благодаря чему пользователи имеют доступ только к своим данным.

### API-эндпоинты

Созданы три основных API-эндпоинта:

- **/api/analytics/track** - универсальный эндпоинт для отправки событий аналитики
- **/api/analytics/heartbeat** - эндпоинт для обновления активности пользователя на странице
- **/api/analytics/page-exit** - эндпоинт для фиксации выхода пользователя со страницы

### React-хуки

Реализованы хуки для удобного использования в компонентах:

- **useAnalytics** - основной хук для отправки событий аналитики
- **usePageTracking** - хук для автоматического отслеживания просмотра страниц
- **useSettingsTracking** - хук для отслеживания изменений в настройках пользователя

### Интеграция с компонентами

Добавлен трекинг действий в следующие компоненты:

- **Player.tsx** - отслеживание воспроизведения, паузы, перемотки и изменения скорости
- **Settings.tsx** - отслеживание изменений настроек
- **app/providers.tsx** - добавлен хук отслеживания просмотра страниц

## Принципы работы системы

Система спроектирована с соблюдением следующих принципов:

1. **Ненавязчивость** - аналитика не влияет на основную функциональность приложения
2. **Минимальное влияние на производительность** - оптимизированы запросы к API
3. **Безопасность** - все данные хранятся в соответствии с принципами RLS
4. **Расширяемость** - легко добавлять новые типы отслеживаемых событий

## Дальнейшие планы

1. Создание дашборда для визуализации собираемых данных
2. Настройка аналитических отчетов
3. Имплементация A/B-тестирования на основе собранных данных

## Как тестировать

Для тестирования аналитики:

1. Запустить приложение локально
2. Выполнить различные действия (загрузка файлов, прослушивание, изменение настроек)
3. Проверить в базе данных, что события корректно записываются в соответствующие таблицы
4. Убедиться, что страницы правильно отслеживаются (открытие, закрытие, heartbeat)
